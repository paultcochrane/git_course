git clone git@<server-name>:<orig-repo-name>.git <new-repo-name>
cd <new-repo-name>/
# delete all commits that don't have anything to do with the `orders` directory
git filter-branch --prune-empty --subdirectory-filter orders master
git remote set-url origin git@<server-name>:<new-repo-name>.git
# fix incorrect email addresses in commits
git filter-branch --original refs/correct_email_orig --env-filter '
OLD_EMAIL="paul@<old-email-provider>"
CORRECT_NAME="Paul Cochrane"
CORRECT_EMAIL="paul.cochrane@<new-email-provider>"
if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
then
export GIT_COMMITTER_NAME="$CORRECT_NAME"
export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
fi
if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
then
export GIT_AUTHOR_NAME="$CORRECT_NAME"
export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
fi
' --tag-name-filter cat -- --branches --tags
git push -u origin master
